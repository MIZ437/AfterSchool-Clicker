# Changelog - AfterSchool Clicker

## 2025-10-15

### Testing
- 🧪 **ゲームバランステスト開始**
  - テストプレイによるバランス検証を実施中
  - 目標プレイ時間（2時間）達成可能性の確認
  - 各ステージ解放までの所要時間計測
  - アイテム購入タイミングとコスト妥当性の検証

### Added
- ✨ **アルバム再生機能実装**
  - アルバム画面からシナリオとエンディングを再生可能に
  - アルバムから遷移した場合は「アルバムに戻る」ボタンのみ表示
  - 通常のゲームフローでは従来のボタンレイアウトを維持
  - `sceneManager.js` に `fromAlbum` パラメータと条件分岐を実装
  - シナリオ・エンディング再生中のクリックポイント加算を無効化
  - アルバムタブ状態の保持機能（シナリオ/エンディングタブから戻った際に同じタブを表示）

### Fixed
- 🐛 **アルバム再生ボタンの即時表示**
  - CSS アニメーション遅延を無効化（`!important` フラグ使用）
  - ボタンの即時クリック可能化（`pointer-events: auto`）
  - 11秒のテキストアニメーション待ち時間を解消

### Changed
- 🎨 **シナリオボタン名称変更**
  - 「ゲーム説明」→「シナリオ」に変更
  - アルバム画面でより直感的な表記に

### Technical Details
- `albumManager.js`:
  - `currentTab` プロパティでタブ状態を追跡
  - `restoreScenarioTab()`, `restoreEndingTab()` メソッド実装
  - `playScenario()`, `playEnding()` に `fromAlbum` フラグ付与
- `sceneManager.js`:
  - `showScene()` メソッドに `fromAlbum` パラメータ追加
  - `initializeScenarioScene()`, `initializeEnding2Scene()` で条件分岐実装
  - クリックシステム無効化リストに `'scenario'` 追加
- `main.css`:
  - `#scenario-back-to-album-btn`, `#ending2-back-to-album-btn` の即時表示スタイル追加

### Current Balance Analysis
**ステージ解放コスト:**
- ステージ1: 0（初期解放）
- ステージ2: 2,000
- ステージ3: 15,000
- ステージ4: 100,000

**アイテムコスト（実装値）:**
- クリック強化: 50 / 2,000 / 25,000 / 300,000 / 3,000,000
- PPS強化: 500 / 5,000 / 50,000 / 500,000 / 5,000,000

**ガチャ総コスト見積もり:**
- 全160枚収集: 約57,000ポイント
- ステージ解放込み: 約174,000ポイント

---

## 2025-10-12

### Added
- ✨ **ラッキーエフェクトシステム実装**
  - クールタイム（5分 + 500クリック）後に虹色ハートが出現
  - 高速移動する虹色ハートをクリックすると大量ポイント獲得
  - 報酬計算式: `(クリック力 + CPS × 1.0) × 最大ステージ + 総ポイント × 0.05`
  - デバッグモード時はクールタイム無効化（即座にスポーン）
  - `luckyEffectManager.js` を新規実装

- ✨ **10連ガチャシステム実装**
  - 単発ガチャに加えて10連ガチャボタンを追加
  - 10連ガチャは5x2のグリッド表示で結果を表示
  - 単発・10連ともに統一されたUIデザイン（黒背景、ゴールド装飾）
  - 10連ガチャの結果表示は順次アニメーション

### Fixed
- 🐛 **ガチャ後の画像表示バグ修正**
  - 単発・10連ガチャ実行後、引いた画像がクリックエリアに表示されない問題を修正
  - `isGachaAnimating` フラグのタイミング問題を解決
  - ガチャオーバーレイ終了後、明示的に `updateHeroineDisplay()` を呼び出すように修正

- 🐛 **アルバム画面のUI改善**
  - 「拡大表示」ボタンを削除し、「画像をクリックすると拡大表示」ヒントテキストに変更
  - 拡大表示モーダルの画像と背景のズレを修正
  - 閉じるボタン（×）の縦方向中央揃え修正
  - 閉じるボタンを画像外側に配置（画像に重ならないように）
  - 黒背景クリックでモーダルを閉じる機能を追加

- 🐛 **BGM音量バランス調整**
  - ステージ2 BGM音量を0.1から0.3に変更（他ステージと統一）

### Changed
- 🎨 **ガチャUIの統一**
  - 単発ガチャの演出を10連ガチャと同じスタイルに統一
  - ボタン回転アニメーションを削除し、オーバーレイ表示方式に変更
  - 獲得テキストを「新しいキャラクターを獲得！」から「新しい画像を獲得！」に変更

- 🎨 **アルバムヒントテキストのスタイル改善**
  - 青グラデーション背景で「戻る」ボタンと統一
  - 大きく太字で目立つデザインに変更

### Technical Details
- `luckyEffectManager.js`: ラッキーエフェクトの完全実装
  - ランダム高速移動アルゴリズム (8px/frame)
  - 虹色グローアニメーション (0.8s)
  - クリック報酬計算とポップアップ表示
- `gachaSystem.js`: 10連ガチャメソッド追加 + UI統一
- `albumManager.js`: モーダル表示ロジック改善
- `game.css`: ラッキーエフェクト、ガチャ、アルバムのスタイル追加/修正
- `audio.csv`: ステージ2 BGM音量調整

---

## 2025-10-11

### Added
- ✨ **ステージ3のヒロイン画像実装**
  - 50枚の画像を追加 (`heroine_3_01.png` ~ `heroine_3_50.png`)
  - `assets/images/heroines/stage3/` ディレクトリに配置
  - `images.csv` に全50件のエントリを追加

- ✨ **ステージ4のヒロイン画像実装**
  - 70枚の画像を追加 (`heroine_4_01.png` ~ `heroine_4_70.png`)
  - `assets/images/heroines/stage4/` ディレクトリに配置
  - `images.csv` に全70件のエントリを追加
  - 全160枚のヒロイン画像実装完了 (10+30+50+70)

### Fixed
- 🐛 **クリック判定エリアの最適化**
  - クリック可能エリアを画像の中央50%に制限
  - 左右25%のマージンを設定し、キャラクター部分のみクリック可能に
  - `clickSystem.js` の `isWithinClickableArea()` メソッドを改善

- 🐛 **クリックエフェクト位置の修正**
  - `#click-effects` コンテナを `body` レベルに移動
  - CSS を `position: absolute` から `position: fixed` に変更
  - ビューポート座標系を使用してエフェクト位置を正確に表示

### Changed
- 🎨 **チュートリアル画面の色調整**
  - 背景を緑系グラデーションからピンク系グラデーション (`#ff9a9e` → `#fecfef`) に変更
  - ステップ背景を緑系からピンク系 (`rgba(253, 121, 168, 0.1)`) に変更
  - ステップ番号バッジを緑 (`#00b894`) からピンク (`#e84393`) に変更
  - ゲーム全体のピンク系配色に統一

- 📝 **データ修正**
  - `stages.csv` のステージ1ヒロイン数を9から10に修正

### Technical Details
- Python スクリプトを使用して画像ファイルを一括コピー・リネーム
- 画像ファイル名は2桁ゼロパディング形式 (01, 02, ..., 70)
- すべての変更をGitHubリポジトリにコミット・プッシュ済み

---

## 2025-10-08

### Added
- ✨ **タイトル画面背景画像の実装**
  - 夕焼けの校舎を背景にした高品質な背景画像を追加
  - `title_background_sunset.png` (1920x1080, 2.6MB)
  - 放課後の雰囲気を完璧に表現

### Changed
- 🎨 **タイトル画面のUI改善**
  - 背景を単色グラデーションから夕焼け校舎の画像に変更
  - コンテンツエリアに半透明の白い背景を追加 (`rgba(255, 255, 255, 0.15)`)
  - ぼかし効果 (`backdrop-filter: blur(10px)`) で視認性を向上
  - ロゴ、キャラクター、ボタンが背景画像と調和しながらしっかり見える

### Technical Details
- `src/styles/main.css`: タイトル画面のスタイル更新
  - 背景画像のパス設定
  - コンテンツエリアのスタイリング強化
- `assets/images/ui/`: 背景画像ファイル追加
  - `title_background_sunset.png` - メイン背景（夕焼け校舎）
  - `title_background.png` - シンプル版（予備）
  - `title_background_classroom.png` - 教室要素版（予備）

### Notes
- 元のグラデーション背景はCSSコメントで保持（簡単に切り替え可能）
- 複数の背景オプションを用意し、必要に応じて切り替え可能な設計

---

## Previous Updates

### ゲームシステム実装状況
- ✅ 基本ゲームシステム完成（クリック、ショップ、ガチャ、セーブ/ロード）
- ✅ 全ステージのヒロイン画像実装完了 (160枚)
  - ステージ1: 10枚
  - ステージ2: 30枚
  - ステージ3: 50枚
  - ステージ4: 70枚
- ✅ 音響システム完成（BGM、SE、フェード機能）
- ✅ アルバム機能実装
- ✅ UI/UX完成（全画面の色調統一、クリック判定最適化）
- ❌ 報酬動画未実装 (4本) - オプション
- ⏳ 最終テスト・バランス調整 - 残作業
- ⏳ 配布用ビルド作成 - 残作業

### 進捗率
- **プログラム**: 100% (完成)
- **コンテンツ**: 100% (全ヒロイン画像実装完了)
- **UI/UX**: 100% (完成)
- **全体進捗**: 95% (テスト・ビルドのみ残)
